задачи:

bf:
+++-не удаляем последний статус работника
+++-галка в турв при заполенном синяяя а не зеленая
при печати грида левый заголовок таблицы
при изменении статуса тем же днем dt2p ставится не конец турв  а  предыдущий
  день от выбранного (где-то в Turv.Synchronize)
в справочнике стд.изд. в группе Общие кнопки изменения изделий не заблокированы, однако они не работоспособны,
  вывалиывается ошибка при попытке редактировать/измениить
фильтр вида
   Frg1.Opt.FilterRules := [[], ['dt_beg;dt_end'], ['Только незакрытые', 'Closed', ' dt_end is null ', True], ['Только с ненулевой суммой', 'NullSum', ' nvl(cost,0) > 0 ', True]];
   неправильно настраивается, не добавляет пробелы в  условиях  при  соединении and
при просмотре сметы по заказу, в футере не расчитывается суммарное количество отмеченных индикаторными чекбоксами (не всегда)
П25769_40,П25780_41,П25847_1,М252417
в семете по П250817 клей расплав - пуcтое количество (null)
неверный статус (галка) в детальной таблице ордерстажес
зп ваедомости - несмотря на запрос при закрытии  приложения  по  кнопке  Отмена
  фонрма и приложание закрываются

дработать:
при удалении из грида - ставить курсор на предыдущую запись
про добавлении - на новую запись
подстановка dlgedit не заменяется на пустую строку при удалении!!!
сделать функцию для  хелпа  для  грида  -  добавлять  заголовок,  подсказку по действиям...


procedure TFrDBGridEh.GetGridDimensions(var AWidth, AHeight: Integer);
//получим размер грида (нужно если например надо подогнать панель так чтобы весь грид был виден)
//!!! не учитывал индикаторный столбец. доделать пареаметр для установки размера грида. доделать параметр для установки размера фрейма. доделать учет панелей фрейма


вопросы:
-нужны ли вообще нормы в подразделениях +++  по  ним  создаются  новые  периоды
турв
-сделать ли ввод времени в тур равным получасу?
+++-надо ли в зп при экспортев эксель подпись?



---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
+++В РАЗБОРЕ после с СГП - на печать тоже
+++фильр Просроченные заказы  (на сегодня и + 7 дней)


в журнале приемки на сгп - сколько осталось принять по слешу
+++в журнале заказов в детальной таблице - в разборе, контрльная сборка, сколько осталось принять на сгп

пометка - фильтр почты по ПЗ в последнюю очередь


--------------
смета
-квадратура плитных
-длина кромочных
-квадратура покраски

все вместе, но по выбранным нескольким группам в итм
(разделить по группам, с Ильей)


алгоритм:
выбрать период зщаказов (просто фильтр в журнале заказов)
отметить заказы галками и инфа по ним
кнопка показать трудоемкость -
 квадратуры, длна кромки, квадратура покраски, кол-во панелей со сверлением


+++ инфа по заказам для дир пр-ва
  по отмеченным заказам
  количество заказов, слэшей, изделий, изделий, не принятых отк



---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
справочник рабочих центров
РЦ1, РЦ2
Кромка1 (665)
Кромка2 (665)
Кромка3 (668)
Криволинейная кромка 1
Криволинейная кромка 2
Сверлильный центр №№1-5
ЧПУ №№1,2
Фрезер
Форматник
Участок стекло
Участок камень
Сборка №№1-4
Упаковка
Электирика
Реклама
Лакокраска
Камень
Сборка ящиков


журнал заказов:
+++-добавить Изделий принято на СГП
-дата запуска в работу (всего заказа)
(из итм при создании НП на склад производства, если в материалах есть плитные - любые из этой группы и подгрупп)
-фильтр "запущенные в работу"
-плановое окончание работы по участку Станки
(дата запуска + 5 дней - 5 дней на прохождение участка включая текущий)
-столбец "дней до отгрузки"
(просрочку - с минуса - выделяем красным)
(расчет:
дт оформления 07-06
плановая сдача заказа 28.06
сегодня 11-06 - дней до отгрузки - 17
сегодня 13-06, д.о. 15 дней
если до отгрузки осталось менее 40%  всего  времени  (от  оформления  до  план.
отгр.), и нет запуска в работу - подсветим красным, и всю строку розовым,
и для фильтра сделать столбец Просрочка (напр красный -)
/весь этот расчет имеет смысл для заказов, в общей смете которых, за исключением слешей с сгп, есть плитные материалы/
/обновлять статусы серверным процессом раз в час/

-распил, м2   (все плитные крому стекла)
-кромка, м.п. (кроме обработки стекла)
-профили, шт
-кол-во панелей со сверлением, шт


кромочные
-меламин
-пвх
-шпон

плитные
-массив щит
-мдф
-лдсп
-пластик hpl
-пластик рекламный
-хдф/двп
-фанера
-шпон


===========================================================================================
===========================================================================================
===========================================================================================
журнал планирования
===========================================================================================
заказы и в детальной таблице слеши по ним - только те, которые не с сгп.
все даты - плановая и фактическая
дата создания
смета п/ф  всегда 3 дня, не плюсуется к следующим
документы КНС  30% если есть
документы ТХН  20% (есть в любом случае, если не с сгп)
производство + финиш заказа = 100% - (кнс + тхн) = 50-80%
производство
  станки                             40%
  сборка                             15%
  покараска          если есть ЛК    15%
  финишная сборка    если есть ЛК    15%
финиш заказа                         15%
  отк                                плановая дата окончания у них одинаковая
  сгп                                -
  упаковка                           -
отгрузка п/ф

первый день (дата оформления) не входит в регламент.
сначала считаются проценты, округляются по правилам математического округления
плановая дата следующего участка будет = плановая  предыдущего  +  кол-во  дней
(может быть тот же день в принципе).

регламенты:
дт.отгр. - дт.оф. + 1  (с 1го по 4е = 4 дня)
-рекламация - 4 дня
кнс=тхн=производство=финиш = 1 день
отк, сгп и упаковка получаются в один день
-новый 14 дней
-новый 21 день
(в ПЗ запретить ставить регламент < 4 дней если есть слеши не с сгп)

14д:
нач 1го
кнс 30%=4.2 = 5го
тхн 8го
стн 11го
сб 12го
покр 13го
ф.сб. 14го
финиш 15го
окончание 16го

если получаем окончание более регламента то:
уменьшаем на день кнс, если мало то далее тхн, если мало то далее станки, и так
в цикле, но не менее дня на этап
если окончание ранее регламента, то таким же образом прибавляем дни

---------------------------------
металл
вд прихода сгп - плановая отгр   опережение / просрочк


----------------------------------
поиск стандартного изделий во всех группах
новый формат заказа на печати и в эксель - id_type2
загрузка xml
<BOARDROOTNODE>
  <SMPBOARDS>, <FIGBOARDS>, <BENTBOARDS>
    проход по
      <BOARDSMP>
      <QTY> = кол-во панелей
      <DRILLING> = данные по сверловке, если сверловки нет то не содержит элементов (<DRILLING/>)

----------------------------------
в таблице СН галка Контролировать счета
отслеживать по таймеру появление счета в итм, если цена по этим позициям в счете превышает контрольную,
то отправлять на почту предупреждение.


для человека две записи, напр разные графики, нормы за период
1  оклад 10000, норма 80 за 2нед, график1, отработано 20ч
2  оклад 10000, норма 88 за 2нед, график2, отработано 70ч
в итоге больше нормы за весь период, но в каждой записи меньше нормы
итого начислено расчитывается для каждой строки.
как надо посчитать в случае если в ркасчете оклада при учете не более нормы,
и при учете всего отработанного времени.




допустим для данного метода не больше нормы. как мне
как мне применить правило

один работники, в периоде две строки (2 графика)
1  оклад 10000, норма 80, 8 дней, график1, отработано 50 итого начислено?
2  оклад 10000, норма 88, 7 дней, график2, отработано 40 итого начислено?
итого начислено расчитывается для каждой строки.
допустим для данного метода не больше нормы.
итоговое время работы по 2 строркам  больше  нормы,  надо  уменьшаять  значение
начисленияя, но как это уменьшение распределить на 2 строки???

---
плановые графики работы по дням, для каждого графика
(часы или В)
лучше если возможно преносить раскладку автоматически
в турв -
клик на работники - покажет плановую раскладку за период по этому работнику
клик на заголовке дня - покажет плановую раскладку по работникам на этот день
в расчетных ведомостях все переработки/недоработки учитываются по каждому дню.
в расчетных ведомостях отличаются ведомость  за  первый  и  второй  период,  во
второй тянутся итоговые данные из первого как аванс

--
в турв убираем Бригадир
убираем Ученик

вводим открытый справочник персональных надбавок (наименование, сумма за месяц)
(бригадир до 10 человек = 3000, заведующий складов = 5000...)
в турв для каждого  работника  можно  выбрать  ни  одной,  одну  или  несколько
надбавок с и по произвольную дату.
надбавка суммируется в пересчкете на отработанные часы за период, но  не  более
нормы (отработанные и норма с учетом переносов ДО)
выводится  признак наличия персональная надбавка, по клику на ней  раскрываются
подробноси. (больше никак надбавку в самом турве не увидишь)
надбавка назначается с конкретного числа работнику (можно  кликом  на  ячейке),
дата завершения не указывается, пока не будет сделана отмена  надбавки.  должна
переходить   на    следующий    месяц,    но    при    переводе    на    другую
должность/подразделение сниматься (но  не  сниматься,Ю  если  изменен  график).
оптимально видеть галочку в той строке, для которой  конкретно  в  этот  период
есть надбавка (и можно двойную галочку если надбавок несколько)

признак Бригадир вводится для подразделения, может  быть  только  один  или  ни
одного. может проставлять мастер. индикацию можно галочкой (синяя в строке, где
хотя бы день был бригадиром, и зеленая когда бригадир за тот день,  на  котором
стоит курсор; также можно отрисовать полосу вверху ячеек, но  там  комментарии,
или выделить цветом рамку)

расчетная ведомость, ведомость к перечислению, ведомость к выдаче
(за первый период, за месяц)
но в журнале даты как сейчас, первая и вторая половина.

в ведомости каждыый статус идет отдельной строкой. в месячной будет две строки,
даже если смена статуса произошла в первой половине.

расчетная ведомость идет по  подразделениям,  ведомость  к  перечислению  общим
списком,  ведомость  к  выдаче   по   подразделениям,   работник   попадает   в
подразделениее в котором на последний момент находится.

три метода расчета, привязаны как сейчас к  ведомости.  у  каждого  метода  три
вырианта учета переработок.

загрузка сделки также из экселя

переработки - за день с обоими значками. для всех.
если  выходной  по  плановому  графику,  и  человек  работал,  то  все  идет  в
переработку.
в ведомости в итоговую переработку суммируются дневные, но если стоит статус не
(бл, от), то за эти дни добавляется  из  переработки  по  плановому  времени  к
рабочему времени, а из переработток эти часы вычитаются.
то есть переработка за день: (время работы, или 0 если код) - (время графика).
но если код БЛ/ОТ, то переработка 0
а за период: сумма этих переработок, но не меньше 0

надбака за молоко - про должности, сумма * отработаное время / норму
персональная надбавка - для каждой надбаки и ее периода действия,
сумма * отработаное время во время действия надбавки / норму месяц

руководитель подразделения можкет просмотреть все  типы  ведомостей  но  только
строки по конкретному работнику, и не может их выгруззить или распечатать.

отчет по преработкам?

в турв подсвечивать ячейки, гжде  выход  во  время  БЛ,  ОТ,  В  по  плановомму
графику

проставление выходных в комментариях из графика - по офису руководителям, и  по
парсеку

!!!неверная дата события в статусах работников после добавлдения записи!!!


Сергей,  у нас  3 метода расчета з/п с разными способами расчета переработки.

1. Метод расчета - Офис:
Плановое начисление  = Постоянная часть + Стимулирующая выплата
Расчет = (постоянная часть / норма рабочих часов за месяц * отработанные часы ) + (стимулирующая выплата * ОРС / норма рабочих часов за месяц * отработанные часы)
 В данном методе расчета ОРС по умолчанию равен 100%
В данном методе расчет переработок должен учитываться 3-я способами:
1.1 Не учитывается вообще, даже если часы переработки учтены в табели учета рабочего времени
1.2 Рассчитываются с коэффициентом  - 1
Расчет = (постоянная часть  + (стимулирующая выплата * ОРС ) / норма рабочих часов за месяц * часы переработки  * коэффициент 1
1.3 Рассчитываются с коэффициентом  - 1,5
Расчет = (постоянная часть  + (стимулирующая выплата * ОРС ) / норма рабочих часов за месяц * часы переработки  * коэффициент 1,5

2. Метод расчета - Цех
Плановое начисление  = Постоянная часть + Стимулирующая выплата
Расчет = (постоянная часть / норма рабочих часов за месяц * отработанные часы ) + (стимулирующая выплата * ОРС  / норма рабочих часов за месяц * отработанные часы)
В данном расчете нужно применить формулу для ОРС, если

2.1 Не учитывается вообще, даже если часы переработки учтены в табели учета рабочего времени
2.2 Рассчитываются с коэффициентом  - 1
Расчет = (постоянная часть  + (стимулирующая выплата * ОРС ) / норма рабочих часов за месяц * часы переработки  * коэффициент 1
2.3 Рассчитываются с коэффициентом  - 1,5
Расчет = (постоянная часть  + (стимулирующая выплата * ОРС ) / норма рабочих часов за месяц * часы переработки  * коэффициент 1,5

3. Метод расчета - Загрузка мотивации
В данном методе расчета показатель расчета з/п  загружается из файла мотивации, а именно станки, мастера, продажи, монтаж, конструктора
В данном методе расчета переработки не рассчитываются, так как часы переработки уже входят в расчет мотивации.
Та же при данном методе не должен рассчитываться показатель персональной надбавки, так как данный показатель тоже уже учтен в расчете мотивации
в этом режиме скрываются и пустые: Плановое начисление	Постоянная часть	Стимулирующая	ОРС	Итого рассчитано
считаются ли премии, надбавки за молоко, штрафы?


!!!продлевать суммы персональных надбавок в справочнике Виды надбавок
!!!не снимаются блокировки после закрытия турв - проверял у себя, у  меня  все работает!
+разрешать изменение ширины столбцов в расчетной ведомости
+в расчетной ведомости стандартная выгрузка в эксель

ведомости к перечислению - общая по всем подразделением и отдельные  по  каждой
  ведомости на уволенных
создаются по кнопке все сразу
контроля обновления нет, в каждой ведомости кнопка обновить, подгружает  данные
и выдает инфу об изменениях
к выдаче - так же
в работниках номер карточки из парсек

в расчетной ведомости при  загрузке  плановое  начисление  и  постоянную  часть
  тянуть из прошлой ведомости по тому же работнику!!!
в расчетной ведомости при ввода плановое  начисление автоматически вносить в другие строки по этому же работниику в этой должности.
в  расчетной  ведомости  за  2й  период  данные  из  ведомости  за  1й   период
  подтягиваются только при первом  заполнении  ведомости,  и  в  дальнейшем  не
  изменяютсмя. в том числе список уволенных,  которых  не  тянем  в  ведомость,
  формируется на основе уволенных за весь период, но только в этот момент.
при создании ведомости на уволенного, надо ли его автоматически убирать из основной зп ведомости???
  в ведомсти за 2п сделать сортировку работников при начальной загрузке






---------------------------------------------------------------------------------
1. Формирование заявок на снабжение
- Добавление чек-бокса для контрольной цены. Функция слежение за контрльной ценой, все сделки
при подгрузке счета выше контрольной цены инициирует оповещение на почту. В письме материал и цена, мб счет.
Периодичность раз в час.
- Обновление контрольной цены, после прихода материала с ценой меньше контрольной,
записывать цену прихода в "контрольную" цену.
-Анализ проведенной сделки. Покупку с ценой выше контрольной умножаем на количество
купленного и суммируем такие сделки. С покупками с ценой ниже контрольной делаем то же самое.
  Баланс на месяц. Каждый новый месяц начинаем с нуля. Итоги месяца записываем в журнал.
Если не было контрольной цены, записываем цену покупки в контрольную цену.
сортировка в ведосмости к перечислению при загрузки из расчетной.
!--убрать временное разрешение в TFrmWWedtWorkSchedule.SetControlsEditableState
убрать боригадира из справочника подразделений









---
выгрузка по сн за 35й год
номенклатура, кол-во сделов по пН, колво номенклатуры, сумма общая


ед изм, кол-во

в орассылку
енаим, цена завки, контрольная, ед-изм, кол-во в заявке, разница с контрольной,
сумма по счету!
ценой (заявка*кол - контр * кол), № и дата
кол-во, разницу по ценам как в отчете по сн

итоговое письмо Счета снабжения за день
подсвечивать положительное
факты заведения ПН без счетов
ежечасно, и в итоговое письмо, только номера накладныых
менеджер кто вносил счет
общая сумма по счета
письмо, даже если счетов нет
отчет по вчерашним счетам из ПК, по каждому сотруднику таблица с данными счета и итоговая
сумма
сделать галку Контролировать цену проставленной по умолчанию!

+++отчет по тр средствам - вытащить дату поездки, корторая есть внутри счета


янин

работники не обновились! :
master_st